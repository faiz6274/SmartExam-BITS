services:
  - type: web
    name: smartexam-backend
    runtime: python
    runtimeVersion: "3.11"
    plan: free # Change to "starter" or "standard" for production
    buildCommand: "cd SmartExam_Backend && pip install --upgrade pip && pip install -r requirements.txt && python manage.py collectstatic --noinput"
    preDeployCommand: |
      cd SmartExam_Backend && python manage.py migrate --noinput
    startCommand: cd SmartExam_Backend && gunicorn backend.wsgi:application --bind 0.0.0.0:${PORT:-8000} --workers 2
    envVars:
      - key: DEBUG
        value: "0"
      - key: DJANGO_SECRET_KEY
        generateValue: true
      - key: ALLOWED_HOSTS
        value: "*" # Set to your Render domain after deployment
      - key: USE_LOCAL_DB
        value: "0" # Use PostgreSQL, not SQLite
      - key: POSTGRES_SSLMODE
        value: "require"
      - key: SECURE_SSL_REDIRECT
        value: "1"
      - key: SESSION_COOKIE_SECURE
        value: "1"
      - key: CSRF_COOKIE_SECURE
        value: "1"
      - key: SECURE_HSTS_SECONDS
        value: "31536000"
      - key: SECURE_HSTS_INCLUDE_SUBDOMAINS
        value: "1"
      - key: SECURE_HSTS_PRELOAD
        value: "1"
      - key: DATABASE_URL
        fromDatabase:
          name: smartexam-db
          property: connectionString

databases:
  - name: smartexam-db
    databaseName: smartexam
    user: postgres
    plan: free # Change to "standard" for production
