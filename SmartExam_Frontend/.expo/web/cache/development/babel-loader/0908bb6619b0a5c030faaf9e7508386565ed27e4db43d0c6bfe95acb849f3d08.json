{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axios from \"axios\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nvar USE_PROD = true;\nvar PROD_API_BASE = \"http://13.200.180.132/api/\";\nvar LOCAL_API_BASE_ANDROID = \"http://10.0.2.2:8000/api/\";\nvar LOCAL_API_BASE_IOS = \"http://localhost:8000/api/\";\nvar ensureTrailingSlash = function ensureTrailingSlash(u) {\n  return u.endsWith(\"/\") ? u : u + \"/\";\n};\nvar API_BASE;\nif (USE_PROD) {\n  API_BASE = ensureTrailingSlash(PROD_API_BASE);\n} else {\n  API_BASE = ensureTrailingSlash(Platform.OS === \"android\" ? LOCAL_API_BASE_ANDROID : LOCAL_API_BASE_IOS);\n}\nvar api = axios.create({\n  baseURL: API_BASE,\n  timeout: 30000,\n  headers: {\n    Accept: \"application/json\",\n    \"Content-Type\": \"application/json\"\n  },\n  xsrfCookieName: \"\",\n  xsrfHeaderName: \"\"\n});\nconsole.log(\"API Base URL:\", api.defaults.baseURL);\nvar PUBLIC_ENDPOINTS = new Set([\"register\", \"register/\", \"login\", \"login/\", \"token\", \"token/\", \"health\", \"health/\", \"csrf\", \"csrf/\"]);\napi.interceptors.request.use(function () {\n  var _ref = _asyncToGenerator(function* (config) {\n    var _config$url;\n    if ((_config$url = config.url) != null && _config$url.startsWith(\"/\")) {\n      config.url = config.url.slice(1);\n    }\n    var urlPath = String(config.url || \"\");\n    var normalized = urlPath.endsWith(\"/\") ? urlPath : urlPath + \"/\";\n    var isPublic = PUBLIC_ENDPOINTS.has(normalized);\n    if (!isPublic) {\n      try {\n        var token = yield AsyncStorage.getItem(\"accessToken\");\n        if (token) {\n          config.headers.Authorization = \"Bearer \" + token;\n        }\n      } catch (e) {\n        console.warn(\"AsyncStorage token read failed:\", (e == null ? void 0 : e.message) || e);\n      }\n    }\n    return config;\n  });\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}());\napi.interceptors.response.use(function (response) {\n  return response;\n}, function (error) {\n  var _error$config, _error$config2, _error$config3, _error$response, _error$response2, _error$response3;\n  console.log(\"API Error Details:\", {\n    message: error.message,\n    code: error.code,\n    method: (_error$config = error.config) == null ? void 0 : _error$config.method,\n    url: (_error$config2 = error.config) == null ? void 0 : _error$config2.url,\n    baseURL: (_error$config3 = error.config) == null ? void 0 : _error$config3.baseURL,\n    status: (_error$response = error.response) == null ? void 0 : _error$response.status,\n    statusText: (_error$response2 = error.response) == null ? void 0 : _error$response2.statusText,\n    responseData: (_error$response3 = error.response) == null ? void 0 : _error$response3.data\n  });\n  return Promise.reject(error);\n});\nexport default api;\nexport var testConnection = function () {\n  var _ref2 = _asyncToGenerator(function* () {\n    try {\n      var res = yield api.get(\"health/\");\n      console.log(\"Connection OK:\", res.data);\n      return true;\n    } catch (e) {\n      console.error(\"Connection failed:\", e.message);\n      return false;\n    }\n  });\n  return function testConnection() {\n    return _ref2.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["axios","AsyncStorage","Platform","USE_PROD","PROD_API_BASE","LOCAL_API_BASE_ANDROID","LOCAL_API_BASE_IOS","ensureTrailingSlash","u","endsWith","API_BASE","OS","api","create","baseURL","timeout","headers","Accept","xsrfCookieName","xsrfHeaderName","console","log","defaults","PUBLIC_ENDPOINTS","Set","interceptors","request","use","_ref","_asyncToGenerator","config","_config$url","url","startsWith","slice","urlPath","String","normalized","isPublic","has","token","getItem","Authorization","e","warn","message","_x","apply","arguments","response","error","_error$config","_error$config2","_error$config3","_error$response","_error$response2","_error$response3","code","method","status","statusText","responseData","data","Promise","reject","testConnection","_ref2","res","get"],"sources":["C:/Users/Administrator/Documents/GitHub/SmartExam-BITS/SmartExam_Frontend/src/api/axios.js"],"sourcesContent":["\r\n// src/axios.js\r\nimport axios from \"axios\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { Platform } from \"react-native\";\r\n\r\n/**\r\n * Toggle this to route API calls:\r\n *  - true  => Production (EC2)\r\n *  - false => Local development (emulator/simulator)\r\n */\r\nconst USE_PROD = true;\r\n\r\n/** ====== Base URLs (WITH trailing slash) ====== */\r\n// EC2 public IP (HTTP as requested) — trailing slash is IMPORTANT\r\nconst PROD_API_BASE = \"http://13.200.180.132/api/\";\r\n\r\n// Local development — trailing slash as well\r\nconst LOCAL_API_BASE_ANDROID = \"http://10.0.2.2:8000/api/\";\r\nconst LOCAL_API_BASE_IOS = \"http://localhost:8000/api/\";\r\n\r\n// Ensure trailing slash defensively\r\nconst ensureTrailingSlash = (u) => (u.endsWith(\"/\") ? u : u + \"/\");\r\n\r\n/** Resolve API base depending on platform/toggle */\r\nlet API_BASE;\r\nif (USE_PROD) {\r\n  API_BASE = ensureTrailingSlash(PROD_API_BASE);\r\n} else {\r\n  API_BASE = ensureTrailingSlash(\r\n    Platform.OS === \"android\" ? LOCAL_API_BASE_ANDROID : LOCAL_API_BASE_IOS\r\n  );\r\n}\r\n\r\n/** ====== Axios instance ====== */\r\nconst api = axios.create({\r\n  baseURL: API_BASE,              // e.g., http://13.200.180.132/api/\r\n  timeout: 30000,\r\n  headers: {\r\n    Accept: \"application/json\",\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n  // CSRF not needed for token-based API\r\n  xsrfCookieName: \"\",\r\n  xsrfHeaderName: \"\",\r\n});\r\n\r\n// Helpful startup log\r\nconsole.log(\"API Base URL:\", api.defaults.baseURL);\r\n\r\n/** ====== Public endpoints (exact path names) ====== */\r\n/**\r\n * Use relative paths WITHOUT leading slash so Axios appends to baseURL correctly.\r\n * Examples:\r\n *   api.post(\"register/\") => http://13.200.180.132/api/register/\r\n */\r\nconst PUBLIC_ENDPOINTS = new Set([\r\n  \"register\",\r\n  \"register/\",\r\n  \"login\",\r\n  \"login/\",\r\n  \"token\",\r\n  \"token/\",\r\n  \"health\",\r\n  \"health/\",\r\n  \"csrf\",\r\n  \"csrf/\",\r\n]);\r\n\r\n/** ====== Request interceptor (attach JWT) ====== */\r\napi.interceptors.request.use(async (config) => {\r\n  // Normalize any accidental leading slash\r\n  if (config.url?.startsWith(\"/\")) {\r\n    config.url = config.url.slice(1);\r\n  }\r\n\r\n  // Normalize to compare without trailing slash\r\n  const urlPath = String(config.url || \"\");\r\n  const normalized = urlPath.endsWith(\"/\") ? urlPath : `${urlPath}/`;\r\n  const isPublic = PUBLIC_ENDPOINTS.has(normalized);\r\n\r\n  if (!isPublic) {\r\n    try {\r\n      const token = await AsyncStorage.getItem(\"accessToken\");\r\n      if (token) {\r\n        config.headers.Authorization = `Bearer ${token}`;\r\n      }\r\n    } catch (e) {\r\n      // Non-fatal: continue without token\r\n      console.warn(\"AsyncStorage token read failed:\", e?.message || e);\r\n    }\r\n  }\r\n\r\n  return config;\r\n});\r\n\r\n/** ====== Response interceptor (centralized debug) ====== */\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    // Helpful error log\r\n    console.log(\"API Error Details:\", {\r\n      message: error.message,\r\n      code: error.code,\r\n      method: error.config?.method,\r\n      url: error.config?.url,\r\n      baseURL: error.config?.baseURL,\r\n      status: error.response?.status,\r\n      statusText: error.response?.statusText,\r\n      responseData: error.response?.data,\r\n    });\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default api;\r\n\r\n/** ====== Connectivity test ====== */\r\nexport const testConnection = async () => {\r\n  try {\r\n    // Call a simple health endpoint if available\r\n    const res = await api.get(\"health/\"); // resolves to http://.../api/health/\r\n    console.log(\"Connection OK:\", res.data);\r\n    return true;\r\n  } catch (e) {\r\n    console.error(\"Connection failed:\", e.message);\r\n    return false;\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}